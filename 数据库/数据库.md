# 数据库

### 数据库左连接，右连接，内连接，全外连接

在对数据库进行查询操作时，可以单表查询，也可以多表连接查询，进行多表连接时，有不同的方式。

1. 自连接：同一张表，自己和自己连接

   ```sql
   SELECT b.lastStation, b.nextStation, a.lastStation, a.nextStation  FROM bus_sche a, bus_sche b WHERE b.nextStation = a.lastStation;
   ```

   只在一张表中查询，表 bus_sche 使用了两个别名 bus_sche a, bus_sche b，因此相当于有两张表，用 WHERE条件连接查询，「 **实际只有一张表在自我连接查询**」。

2. 内连接

   内连接查询操作只列出与连接条件匹配的数据行，使用 **INNER JOIN** 或者直接使用 **JOIN** 进行连接。

   ```sql
   SELECT * from Table_A JOIN Table_B;
   SELECT * from Table_A INNER JOIN Table_B;
   ```

   内连接可以没有连接条件，没有条件之后的查询结果，会保留所有结果（**笛卡尔集**），与后面分享的交叉连接差不多。

   返回的结果中，两张表的列直接拼接在一起，重复的列在后面添加数字序号以做区分。例如下图：

   ![img](数据库.assets/v2-da04c0e4f55468a6e707a67e27df7f50_1440w.jpg)

3. 左连接（左外连接）：

      ```sql
      select * from a_table a left join b_table b on a.a_id = b.b_id;
      ```

      左表的记录会全部表示出来，而右表只会显示符合搜索条件的记录，右表记录不足的地方均为null。

4. 右连接（右外连接）：

      ```sql
      select * from a_table a  right outer join b_table b  on a.a_id = b.b_id;
      ```

      与左(外)连接相反，右(外)连接，左表(a_table)只会显示符合搜索条件的记录，而右表(b_table)的记录将会全部表示出来。左表记录不足的地方均为null。

5. 全连接：

      ```sql
      SELECT * from Table_A A FULL JOIN Table_B B ON A.id=B.id;
      SELECT * from Table_A A FULL OUTER JOIN Table_B B ON A.id=B.id;
      ```

      根据条件找到表 A 和 表 B 的数据的交集，再加上左右表的数据集。

### 数据库索引，索引是不是越多越好

### mysql怎么实现分页

在对数据库进行查询操作时，如果数据量很大，一次性查询可能会变得很慢，可以使用分页查询方式。MySQL通过limit子句实现分页查询，例如：

```sql
select * from orders_history where type=8 order by id limit 10000,10;
```

> 注意：
>
> 1、第一个参数指定第一个返回记录行的偏移量
>
> 2、第二个参数指定返回记录行的最大数目
>
> 3、如果只给定一个参数：它表示返回最大的记录行数目
>
> 4、第二个参数为 -1 表示检索从某一个偏移量到记录集的结束所有的记录行
>
> 5、初始记录行的偏移量是0(而不是 1)，即上述示例返回第10001行到10011行

缺点：随着查询记录量越来越大，所花费的时间也越来越多；随着查询偏移的增大，查询时间急剧增加

解决方法：

1. 使用子查询优化：

   先定位偏移位置的 id，然后往后查询，这种方式适用于 id 递增的情况，例如：

   ```sql
   select * from orders_history where type=8 limit 100000,1;
   
   select id from orders_history where type=8 limit 100000,1;
   
   select * from orders_history where type=8 and 
   id>=(select id from orders_history where type=8 limit 100000,1) 
   limit 100;
   
   select * from orders_history where type=8 limit 100000,100;
   ```

   4条语句的查询时间如下：

   第1条语句：3674ms

   第2条语句：1315ms

   第3条语句：1327ms

   第4条语句：3710ms

2. 

分布式数据库的原理

SQL语言，一个学生成绩表，选择某科成绩最高学生的语句